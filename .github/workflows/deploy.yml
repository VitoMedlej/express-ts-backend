name: Deploy Express API

on:
  push:
    branches:
      - master  # Trigger deployment on push to the main branch

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up SSH Agent with Key and Passphrase
        uses: marwaha-raghav/ssh-agent-ansible@v0.2.1
        with:
          SSH_AUTH_SOCK: "/tmp/ssh_agent.sock"
          SSH_KEY_PASSPHRASE: ${{ secrets.SSH_PASSPHRASE }}
          ANSIBLE_SSH_KEY: ${{ secrets.SSH_PRIVATE_KEY }}

      - name: SSH into server and deploy
        run: |
          ssh -o StrictHostKeyChecking=no -p 21098 heefbirelp@millionairebia.com << 'EOF'
            cd /home/heefbirelp/express-ts-backend
            git pull origin master  # Assuming you're using git to manage your code
            npm install             # Install any new dependencies
            pm2 restart express-ts-backend  # Restart your app using pm2
          EOF
